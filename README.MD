# ğŸ“Š Compliance Analytics â€“ Setup Guide  

![.NET](https://img.shields.io/badge/.NET-8.0-512BD4?logo=dotnet&logoColor=white)  
![Docker](https://img.shields.io/badge/Docker-Desktop-2496ED?logo=docker&logoColor=white)  
![SQL Server](https://img.shields.io/badge/SQL%20Server-2022-CC2927?logo=microsoftsqlserver&logoColor=white)  
![Redis](https://img.shields.io/badge/Redis-7-DC382D?logo=redis&logoColor=white)  

A full-stack .NET 8 project with **SQL Server 2022**, **Redis cache**, and **JWT authentication**.  
Easily spin up the environment with Docker and start running compliance analytics queries.

---

## ğŸš€ What Youâ€™ll Get
- âœ… SQL Server 2022 running inside Docker  
- âœ… Database initialized with **schema**, **seed data**, and **stored procedure**  
- âœ… Optional **Redis cache** (via Docker)  
- âœ… .NET 8 API connected to the DB  
- âœ… Ability to **register/login users** and query analytics with JWT authentication  

---

## ğŸ“‹ Prerequisites
Make sure you have the following installed:

- [Docker Desktop](https://www.docker.com/products/docker-desktop) (with Docker Compose)  
- [.NET 8 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/8.0)  
- (Optional) [Azure Data Studio](https://learn.microsoft.com/en-us/sql/azure-data-studio) or SSMS for DB inspection  

Check installed SDK:

dotnet --list-sdks
It should show 8.x.

## ğŸ“‚ Project Layout
```
ComplianceAnalytics/
â”œâ”€â”€ docker-compose.yml          # Docker config
â”œâ”€â”€ sql/                        # Auto-run DB scripts
â”‚   â”œâ”€â”€ 01_init.sql             # Schema
â”‚   â”œâ”€â”€ 02_seed.sql             # Sample data
â”‚   â””â”€â”€ 03_procedure.sql        # Stored procedure
â”œâ”€â”€ ComplianceAnalytics.sln
â”œâ”€â”€ ComplianceAnalytics.API/    
â”œâ”€â”€ ComplianceAnalytics.Application/
â”œâ”€â”€ ComplianceAnalytics.Infrastructure/
â”œâ”€â”€ ComplianceAnalytics.Domain/
â””â”€â”€ README.md

```

## âš™ï¸ Configuration
```
Already configured in ComplianceAnalytics.API/appsettings.json:

json

"ConnectionStrings": {
  "DefaultConnection": "Server=localhost,1433;Database=ComplianceAnalytics;User Id=sa;Password=DOTnet@1234;TrustServerCertificate=True"
},
"Jwt": {
  "Key": "This_is_a_very_long_and_secure_secret_key_123!",
  "Issuer": "ComplianceAPI",
  "Audience": "ComplianceUsers",
  "ExpireMinutes": 60
}
ğŸ³ Docker Setup
Your docker-compose.yml (in project root):

yaml

version: "3.9"

services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: compliance_sql
    ports:
      - "1433:1433"
    environment:
      SA_PASSWORD: ${SA_PASSWORD:-DOTnet@1234}
      ACCEPT_EULA: "Y"
    volumes:
      - sql_data:/var/opt/mssql
      - ./sql:/docker-entrypoint-initdb.d
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: compliance_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
    # Comment out if Redis already installed locally

volumes:
  sql_data:
  redis_data:
  ```
## ğŸ—„ï¸ SQL Scripts
```
01_init.sql â†’ Creates database, tables, and log table

02_seed.sql â†’ Inserts sample locations, tasks, and placeholder users

03_procedure.sql â†’ Defines usp_GetComplianceAnalytics stored procedure
```

âš ï¸ Note: Users in seed script use placeholder hashes.
ğŸ‘‰ Always create users via the API to ensure proper password hashing.

### â–¶ï¸ Run Everything

1ï¸âƒ£ Start containers
```
docker-compose up -d
```
2ï¸âƒ£ Watch SQL logs until DB is ready
```
docker-compose logs -f sqlserver
```
3ï¸âƒ£ Connect with Azure Data Studio
```
Server: localhost,1433

User: sa

Password: DOTnet@1234

Database: ComplianceAnalytics
```
4ï¸âƒ£ Verify DB
```
SELECT TOP 5 * FROM Users;
EXEC usp_GetComplianceAnalytics;
```
ğŸŒ Run the API

From project root:
```
dotnet restore
dotnet build
dotnet run --project ComplianceAnalytics.API
```

### Default URLs:
```
Swagger â†’ https://localhost:5001/swagger

API â†’ http://localhost:5000
```
## ğŸ‘¤ Register & Login (API)
#### Register a user
```
curl -X POST "https://localhost:5001/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"userName": "admin", "password": "Admin@123", "role": "Admin"}'
  ```
#### Login to get JWT
```
curl -X POST "https://localhost:5001/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"userName": "admin", "password": "Admin@123"}'
  ```
#### Use JWT for secured endpoints
```
curl -H "Authorization: Bearer <TOKEN>" \
  "https://localhost:5001/api/analytics/compliance?Region=North"
  ```

#### ğŸ”‘ Redis Tips
```
Runs on localhost:6379
```

#### Clear cache in dev:

```
redis-cli -p 6379 FLUSHALL
```

## ğŸ› ï¸ Useful Commands
#### Stop containers:

```
docker-compose down
```
#### Stop & wipe volumes (DB reset):

```
docker-compose down -v
```
#### Re-run SQL script manually:

```
docker exec -it compliance_sql /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P 'DOTnet@1234' \
  -i /docker-entrypoint-initdb.d/03_procedure.sql
  ```